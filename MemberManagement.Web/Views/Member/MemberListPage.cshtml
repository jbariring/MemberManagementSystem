@model MemberManagement.Web.ViewModels.MemberListVM

@section Styles {
    <link rel="stylesheet" href="~/css/member/MemberList.css" asp-append-version="true" />
}

<div class="list-container">

    <div class="header-frame">
        <i class="header-icon fa fa-users"></i>
        <div class="header-text">Member List</div>
    </div>

    <div class="top-row">
        <form id="searchForm" method="get" class="search-form">

            <!-- Search by last name -->
            <input id="searchLastName"
                   name="searchLastName"
                   class="search-input"
                   value="@Model.SearchLastName"
                   placeholder="Search by Last Name..." />

            <!-- Branch filter -->
            <select id="branch" asp-for="Branch" asp-items="Model.Branches">
                <option value="">All Branches</option>
            </select>

            <!-- Search button reloads page 1 -->
            <button class="btn-search" type="button" onclick="loadMembers(1)">
                Search
            </button>
        </form>

        <a asp-action="Create" class="btn-create">Create New Member</a>
    </div>

    <!-- AJAX-loaded table + footer -->
    <div id="memberList">
        @await Html.PartialAsync("MemberTable", Model)
    </div>
</div>

<script>
    function loadMembers(pageNumber, pageSizeOverride) {
        const searchLastName = document.getElementById("searchLastName").value;
        const branch = document.getElementById("branch").value;

        // pageSize comes from footer dropdown when provided
        const pageSize = pageSizeOverride ?? @Model.PageSize;

        fetch(`/Member/MemberListPage?searchLastName=${searchLastName}&branch=${branch}&pageNumber=${pageNumber}&pageSize=${pageSize}`, {
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(res => res.text())
        .then(html => {
            document.getElementById("memberList").innerHTML = html;
        });
    }
</script>